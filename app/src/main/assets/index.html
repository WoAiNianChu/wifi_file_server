<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html {
            font-size: 10px;
            font-family: Roboto, Arial, sans-serif;
            word-wrap: break-word;
            color: #030303;
            background-color: #fff;
            -webkit-text-size-adjust: 100%;
        }

        body {
            margin: 0;
            padding: 0 env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            font-size: 1.2rem;
            overflow-x: hidden;
        }
    </style>
</head>

<body>
    <div>

    </div>
    <script src="custom-media-item.js"></script>
    <script>
        let baseUri = window.location.hostname === "127.0.0.1" ? "http://192.168.8.55:8089" : "";
        async function loadFiles() {
            const res = await fetch(`${baseUri}/api/files?path=${new URL(window.location).searchParams.get("path") || ''}`);
            const files = await res.json();
            return files;
        }
        async function render() {
            const files = await loadFiles();
            const container = document.querySelector('div');

            const uri = new URL(window.location).searchParams.get("path") || '';
            files.sort((x, y) => {
                if (x.isDir === y.isDir)
                    return x.name.localeCompare(y.name);
                if (x.isDir)
                    return -1;
                else
                    return 1;
            }).forEach(element => {
                const customMediaItem = document.createElement('custom-media-item');
                if (element.isDir)
                    customMediaItem.setAttribute('src', "icon-folder-m.svg");
                else
                    customMediaItem.setAttribute('src', "icon-file-m.svg");
                customMediaItem.setAttribute('title', element.name);
                let path;
                if (element.isDir) {
                    path = `?path=${encodeURIComponent(uri + "/" + element.name)}&isDir=${element.isDir ? 1 : 0}`;
                } else {
                    path = `${baseUri}/api/files?path=${encodeURIComponent(uri + "/" + element.name)}&isDir=${element.isDir ? 1 : 0}`;

                }
                customMediaItem.setAttribute('href', path);
                container.appendChild(customMediaItem);
            });
        }
        render();
    </script>
</body>

</html>