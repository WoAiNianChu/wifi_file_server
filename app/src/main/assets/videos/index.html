<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频下载工具 - 回形针</title>
    <meta name="description" content="下载TikTok、抖音高清无水印视频">
</head>

<body>
<custom-search></custom-search>
<script src="custom-search.js"></script>
<!-- https://github.com/dexie/Dexie.js -->
<!-- https://dexie.org/docs/API-Reference -->
<script src="dexie.min.js"></script>
<script src="utils.js"></script>
<script>
    const db = new Dexie("videos");
    db.version(1).stores({
        videos: "++_id,title,url,video_type,update_at"
    });
    const customSearch = document.querySelector('custom-search');
    customSearch.addEventListener('submit', async evt => {
        evt.stopPropagation();
        const url = evt.detail;
        if (/^https:\/\/www.tiktok.com\//.test(url)) {
            const video = await downloadVideo(url);
            video.create_at = (new Date() / 1000) | 0;
            video.update_at = (new Date() / 1000) | 0;
            await db.videos.add(video);
        }
        window.open('videos.html', '_blank')
    });

</script>
</body>

</html>