 //        const items = [{
        //            "path": "/storage/emulated/0/backup",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/com.tencent.mm",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/IMG",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/backups",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/PDF",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/jumobile",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/dobby",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/新建文件夹",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Books",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.gs_file",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/mipush",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.ccc",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.tbs",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/PocketBook",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Catfish",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.awp",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Android",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/MOBI",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/MIUI",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.system",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.protected_image",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.bbb",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Download",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.turingdebug",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Music",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.gs_fs3",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/qqstory",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.6226f7cbe59e99a90b5cef6f94f966fd",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Ringtones",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.wku0d2i2d8",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Notifications",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Mob",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Pictures",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/MP4",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Movies",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Telegram",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/DCIM",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/tingshu",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/EpubBooks",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/system",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Audiobooks",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.aaa",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.xlDownload",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.pocketbook",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/qsvf",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/QQBrowser",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/p2plog",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/qianniu",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/browser",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/speedsoftware",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Tencent",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Debug",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/tbs",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/MP3",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.UTSystemConfig",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/monitor",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.mtdfp",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.com.taobao.dp",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/ramdump",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/libs",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.vivo",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.pns",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Videos",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/JPG",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/FileServer",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/TbsReaderTemp",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/alipay",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/Recycle",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/amap",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/JPEG",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/ReadEra",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/OUKDTFT",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/.gs_fs0",
        //            "size": 0,
        //            "isDirectory": true
        //        }, {
        //            "path": "/storage/emulated/0/1.png",
        //            "size": 2048,
        //            "isDirectory": false
        //        }, {
        //            "path": "/storage/emulated/0/1.jpg",
        //            "size": 2048,
        //            "isDirectory": false
        //        }];
        async function getFiles(v) {
            const resposne = await fetch('/api/files' + (v ? '?v=' + v : ''));
            return resposne.json();
        }

        async function loadFiles(v) {
            const files = await getFiles(v);
            render(files);
        }
        const container = document.querySelector('.container');

        function substringAfterLast(string, delimiter, missingDelimiterValue) {
            const index = string.lastIndexOf(delimiter);
            if (index === -1) {
                return missingDelimiterValue || string;
            } else {
                return string.substring(index + delimiter.length);
            }
        }

        function humanFileSize(size) {
            var i = Math.floor(Math.log(size) / Math.log(1024));
            return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];
        };

        function render(items) {
            const results = [];

            items.forEach(obj => {
                const filename = substringAfterLast(obj.path, "/");
                const thumb = obj.isDirectory ? 'icon-file-m' :
                 (/\.(?:jpg|png)$/i.test(obj.path) && 'icon-pic-m') ||
                 (/\.(?:psd)$/i.test(obj.path) && 'icon-ps-m') ||
               'icon-nor-m';
                const fileSize = obj.isDirectory ? '' : humanFileSize(obj.size);
                const item = `<div class="list-group-item" data-type="${obj.isDirectory ? '1' :'0'}" data-path="${encodeURIComponent(obj.path)}">
      <div class="item-inner">
        <div class="item-tit">
          <div class="thumb">
            <i class="icon icon-m ${thumb}">
            </i>
          </div>
          <div class="info">
            <a href="javascript:void(0)" class="tit">
              ${filename}
            </a>
          </div>
        </div>
        <div class="item-info">
          <!--<span class="item-info-list">
            <span class="txt txt-time">
              2019年07月25日
            </span>
          </span>--><span class="item-info-list">
            <span class="txt txt-size">
              ${fileSize}</span>
          </span>
        </div>
      </div>
    </div>
  `;
                results.push(item);
            });

            container.innerHTML = results.join('');

            const listGroupItem = document.querySelectorAll('.list-group-item');
            listGroupItem.forEach(x => {
                x.addEventListener('click', async ev => {
                if(ev.target.dataset.type==="1")
                   location.href=`?v=${ev.target.dataset.path||''}`;
                   else
                   location.href=`/api/files?v=${ev.currentTarget.dataset.path||''}`;
                });
            })
        }

        loadFiles(new URL(location.href).searchParams.get('v')||'');
